#!/usr/bin/env ruby
# encoding: utf-8
module Sword
  require 'sinatra/base'
  require 'optparse'
  require 'yaml'

  @options, @required = {}, Dir.home + '/.sword'
  @library = File.dirname(__FILE__) + '/../lib'
  @settings = YAML.load_file "#{@directory}/settings.yml"
  @list = File.exists?(@required) ? File.read(@required).split("\n") : []

  OptionParser.new do |o|
    o.summary_width = 17
    o.on('-b', '--build', 'Build current project into .zip') {  }
    o.on('-d', '--dir <name>', 'Specify project directory') { |d| @directory = d }
    o.on('--debug', 'Run server noisily') { @options[:debug] = true }
    o.on('-h', '--help', 'Print this message') { puts o; exit }
    o.on('-g', '--gem <name>', 'Add a gem to require') { |g| open(@required, 'a') { |f| f.puts g };
      puts "`#{g}` will be loaded next time you run Sword."; exit }
    o.on('-v', '--version', 'Print Swordâ€™s version') { puts "Sword #{@settings[:version]}"; exit }
  end.parse!

  $:.unshift @library
  require 'application'
  Application.run!
end
